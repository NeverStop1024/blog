(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{488:function(s,t,a){"use strict";a.r(t);var n=a(4),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),t("blockquote",[t("p",[s._v("配合git hooks可以帮我们做许多事情(检查您的提交消息、运行测试、检查代码等)。常见的hooks有pre-commit，commint-msg，pre-push。支持所有 "),t("a",{attrs:{href:"https://git-scm.com/docs/githooks",target:"_blank",rel:"noopener noreferrer"}},[s._v("Git"),t("OutboundLink")],1),s._v(" 钩子。")])]),s._v(" "),t("p",[t("strong",[s._v("gitHooks（常用hooks）")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("pre-commit")]),s._v("：钩子在键入提交信息前运行。")]),s._v(" "),t("li",[t("code",[s._v("prepare-commit-msg")]),s._v("：钩子在启动提交信息编辑器之前，默认信息被创建之后运行。")]),s._v(" "),t("li",[t("code",[s._v("commit-msg")]),s._v("：钩子接收一个参数，存有当前提交信息的临时文件的路径。 如果该钩子脚本以非零值退出，Git 将放弃提交， 因此，可以用来在提交通过前验证项目状态或提交信息。")]),s._v(" "),t("li",[t("code",[s._v("post-commit")]),s._v("：钩子在整个提交过程完成后运行。")])]),s._v(" "),t("h3",{attrs:{id:"安装、配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装、配置"}},[s._v("#")]),s._v(" 安装、配置")]),s._v(" "),t("h4",{attrs:{id:"老版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#老版本"}},[s._v("#")]),s._v(" 老版本")]),s._v(" "),t("blockquote",[t("p",[s._v("v4.x是老版本，v5以后就不太一样了。我们这里以v4.2.5为例。")])]),s._v(" "),t("p",[t("strong",[s._v("1.安装")]),t("br"),s._v(" "),t("code",[s._v("yarn add husky@4.2.5 -D")]),t("br"),s._v(" "),t("strong",[s._v("2.配置")]),t("br"),s._v("\n在packgae.json中添加husky配置，配置完成，接下来就可以正常使用了。")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"husky"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"hooks"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"pre-commit"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lint-staged"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"commit-msg"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"commitlint -E HUSKY_GIT_PARAMS"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h4",{attrs:{id:"新版"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新版"}},[s._v("#")]),s._v(" 新版")]),s._v(" "),t("blockquote",[t("p",[s._v("v5.x后，我们称之为老版本")])]),s._v(" "),t("p",[t("strong",[s._v("1.安装husky")]),t("br"),s._v(" "),t("code",[s._v("yarn add husky -D")]),t("br"),s._v(" "),t("strong",[s._v("2.在packgae.json中添加prepare脚本")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"prepare"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"husky install"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("prepare脚本会在npm install（不带参数）之后自动执行。也就是说当我们执行npm install安装完项目依赖后会执行 husky install命令，该命令会创建.husky/目录并指定该目录为git hooks所在的目录。")]),s._v(" "),t("p",[t("strong",[s._v("3.添加git hooks，运行一下命令创建git hooks")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("npx husky add .husky/pre-commit "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm run test"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("运行完该命令后我们会看到.husky/目录下新增了一个名为pre-commit的shell脚本。也就是说在在执行git commit命令时会先执行pre-commit这个脚本。pre-commit脚本内容如下：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("#!/bin/sh\n. "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$(dirname "')]),s._v("$"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('")/_/husky.sh"')]),s._v("\n   \nnpm run  test\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("可以看到该脚本的功能就是执行npm run test这个命令")]),s._v(" "),t("h4",{attrs:{id:"新旧版本对比"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新旧版本对比"}},[s._v("#")]),s._v(" 新旧版本对比")]),s._v(" "),t("p",[t("strong",[s._v("关于新版本的husky，比老版本多了一个动作。")]),t("br"),s._v("\n老版本：安装 ——> 配置"),t("br"),s._v("\n新版本：安装 ——> 启用 ——> 生成 .husky相关配置")]),s._v(" "),t("p",[t("strong",[s._v("步骤")]),s._v("："),t("br"),s._v("\n1、npm install husky --save-dev 安装"),t("br"),s._v("\n2、npx husky install 手动启用husky"),t("br"),s._v('\n3、npx husky add .husky/pre-commit "npm run lint-staged" 生成husky配置文件（执行完这一步，根目录会有一个 .husky目录）')]),s._v(" "),t("h3",{attrs:{id:"使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),t("h4",{attrs:{id:"配置pre-commit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置pre-commit"}},[s._v("#")]),s._v(" 配置pre-commit")]),s._v(" "),t("h5",{attrs:{id:"旧版"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#旧版"}},[s._v("#")]),s._v(" 旧版")]),s._v(" "),t("p",[s._v("在packgae.json中添加husky配置，配置完成，接下来就可以正常使用了。")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"husky"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"hooks"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"pre-commit"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lint-staged"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h5",{attrs:{id:"新版-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新版-2"}},[s._v("#")]),s._v(" 新版")]),s._v(" "),t("p",[t("code",[s._v('yarn husky add .husky/pre-commit "yarn lint-staged"')])]),s._v(" "),t("h4",{attrs:{id:"配置commit-msg"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置commit-msg"}},[s._v("#")]),s._v(" 配置commit-msg")]),s._v(" "),t("h4",{attrs:{id:"旧版-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#旧版-2"}},[s._v("#")]),s._v(" 旧版")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"husky"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"hooks"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"commit-msg"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"commitlint -E HUSKY_GIT_PARAMS"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h4",{attrs:{id:"新版-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新版-3"}},[s._v("#")]),s._v(" 新版")]),s._v(" "),t("p",[t("code",[s._v("npx husky add .husky/commit-msg 'yarn --no-install commitlint --edit \"$1\"'")])])])}),[],!1,null,null,null);t.default=r.exports}}]);